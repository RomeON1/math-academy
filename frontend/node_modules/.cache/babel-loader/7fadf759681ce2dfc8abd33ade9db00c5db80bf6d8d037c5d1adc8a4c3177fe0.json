{"ast":null,"code":"import axios from'axios';const getAPIBaseURL=()=>{return'/api';};const API_BASE_URL=getAPIBaseURL();const getToken=()=>{return localStorage.getItem('authToken');};const api=axios.create({baseURL:API_BASE_URL,timeout:15000,withCredentials:false});// 🟢 ИСПРАВЛЕННЫЙ INTERCEPTOR - точно добавляет токен\napi.interceptors.request.use(config=>{var _config$method;const token=getToken();if(token){config.headers.Authorization=\"Bearer \".concat(token);console.log(\"\\uD83D\\uDD10 \\u0414\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D \\u0442\\u043E\\u043A\\u0435\\u043D \\u0432 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441: \".concat(config.url));}else{console.log(\"\\u26A0\\uFE0F \\u0422\\u043E\\u043A\\u0435\\u043D \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D \\u0434\\u043B\\u044F: \".concat(config.url));}config.headers['Content-Type']='application/json';config.headers['Accept']='application/json';console.log(\"\\uD83D\\uDE80 API Request: \".concat((_config$method=config.method)===null||_config$method===void 0?void 0:_config$method.toUpperCase(),\" \").concat(config.url));return config;},error=>{console.error('❌ Request Interceptor Error:',error);return Promise.reject(error);});api.interceptors.response.use(response=>{console.log(\"\\u2705 API Success: \".concat(response.status,\" \").concat(response.config.url));return response;},error=>{console.error('❌ API Error Details:',error);return Promise.reject(error);});// 🟢 ИСПРАВЛЕННЫЕ AUTH ФУНКЦИИ - сохраняют токен\nexport const authAPI={register:userData=>api.post('/auth/register',userData).then(response=>{console.log('✅ Регистрация успешна, сохраняем данные');// Сохраняем данные пользователя\nconst userDataToSave={id:response.data.id,name:response.data.username,email:response.data.email,isLoggedIn:true};localStorage.setItem('userData',JSON.stringify(userDataToSave));return response;}),login:credentials=>api.post('/auth/login',credentials).then(response=>{console.log('✅ Логин успешен, сохраняем токен и данные');// 🟢 КРИТИЧЕСКИ ВАЖНО: Сохраняем токен\nif(response.data.access_token){localStorage.setItem('authToken',response.data.access_token);console.log('🔐 Токен сохранен в localStorage');}// Сохраняем данные пользователя\nconst userDataToSave={id:response.data.user_id,name:response.data.username,email:response.data.email,isLoggedIn:true};localStorage.setItem('userData',JSON.stringify(userDataToSave));return response;}),getMe:()=>api.get('/auth/me')};export const courseAPI={getStructure:()=>api.get('/course/structure'),generateTasks:dayNumber=>api.get(\"/course/day/\".concat(dayNumber,\"/tasks\")),getProgress:()=>api.get('/course/progress'),updateProgress:(day,answers,completed)=>api.post(\"/course/progress/\".concat(day),{completed_tasks:completed}),resetProgress:()=>api.post('/course/reset-progress')};export const userAPI={getAllTasks:()=>api.get('/users/tasks'),getTasks:day=>api.get(\"/users/tasks/\".concat(day)),saveTasks:(day,tasks)=>api.post(\"/users/tasks/\".concat(day),tasks),getAnswers:()=>api.get('/users/answers'),saveAnswer:function(day,taskIndex,answer){let isCorrect=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return api.post(\"/users/answers/\".concat(day,\"/\").concat(taskIndex),{answer,is_correct:isCorrect});}};export default api;","map":{"version":3,"names":["axios","getAPIBaseURL","API_BASE_URL","getToken","localStorage","getItem","api","create","baseURL","timeout","withCredentials","interceptors","request","use","config","_config$method","token","headers","Authorization","concat","console","log","url","method","toUpperCase","error","Promise","reject","response","status","authAPI","register","userData","post","then","userDataToSave","id","data","name","username","email","isLoggedIn","setItem","JSON","stringify","login","credentials","access_token","user_id","getMe","get","courseAPI","getStructure","generateTasks","dayNumber","getProgress","updateProgress","day","answers","completed","completed_tasks","resetProgress","userAPI","getAllTasks","getTasks","saveTasks","tasks","getAnswers","saveAnswer","taskIndex","answer","isCorrect","arguments","length","undefined","is_correct"],"sources":["/opt/math-app/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst getAPIBaseURL = () => {\n  return '/api';\n};\n\nconst API_BASE_URL = getAPIBaseURL();\n\nconst getToken = () => {\n  return localStorage.getItem('authToken');\n};\n\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 15000,\n  withCredentials: false,\n});\n\n// 🟢 ИСПРАВЛЕННЫЙ INTERCEPTOR - точно добавляет токен\napi.interceptors.request.use(\n  (config) => {\n    const token = getToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n      console.log(`🔐 Добавлен токен в запрос: ${config.url}`);\n    } else {\n      console.log(`⚠️ Токен не найден для: ${config.url}`);\n    }\n    config.headers['Content-Type'] = 'application/json';\n    config.headers['Accept'] = 'application/json';\n    console.log(`🚀 API Request: ${config.method?.toUpperCase()} ${config.url}`);\n    return config;\n  },\n  (error) => {\n    console.error('❌ Request Interceptor Error:', error);\n    return Promise.reject(error);\n  }\n);\n\napi.interceptors.response.use(\n  (response) => {\n    console.log(`✅ API Success: ${response.status} ${response.config.url}`);\n    return response;\n  },\n  (error) => {\n    console.error('❌ API Error Details:', error);\n    return Promise.reject(error);\n  }\n);\n\n// 🟢 ИСПРАВЛЕННЫЕ AUTH ФУНКЦИИ - сохраняют токен\nexport const authAPI = {\n  register: (userData) => \n    api.post('/auth/register', userData).then(response => {\n      console.log('✅ Регистрация успешна, сохраняем данные');\n      // Сохраняем данные пользователя\n      const userDataToSave = {\n        id: response.data.id,\n        name: response.data.username,\n        email: response.data.email,\n        isLoggedIn: true\n      };\n      localStorage.setItem('userData', JSON.stringify(userDataToSave));\n      return response;\n    }),\n  \n  login: (credentials) => \n    api.post('/auth/login', credentials).then(response => {\n      console.log('✅ Логин успешен, сохраняем токен и данные');\n      \n      // 🟢 КРИТИЧЕСКИ ВАЖНО: Сохраняем токен\n      if (response.data.access_token) {\n        localStorage.setItem('authToken', response.data.access_token);\n        console.log('🔐 Токен сохранен в localStorage');\n      }\n      \n      // Сохраняем данные пользователя\n      const userDataToSave = {\n        id: response.data.user_id,\n        name: response.data.username,\n        email: response.data.email,\n        isLoggedIn: true\n      };\n      localStorage.setItem('userData', JSON.stringify(userDataToSave));\n      \n      return response;\n    }),\n  \n  getMe: () => api.get('/auth/me'),\n};\n\nexport const courseAPI = {\n  getStructure: () => api.get('/course/structure'),\n  generateTasks: (dayNumber) => api.get(`/course/day/${dayNumber}/tasks`),\n  getProgress: () => api.get('/course/progress'),\n  updateProgress: (day, answers, completed) => \n    api.post(`/course/progress/${day}`, { completed_tasks: completed }),\n  resetProgress: () => api.post('/course/reset-progress'),\n};\n\nexport const userAPI = {\n  getAllTasks: () => api.get('/users/tasks'),\n  getTasks: (day) => api.get(`/users/tasks/${day}`),\n  saveTasks: (day, tasks) => api.post(`/users/tasks/${day}`, tasks),\n  getAnswers: () => api.get('/users/answers'),\n  saveAnswer: (day, taskIndex, answer, isCorrect = false) => \n    api.post(`/users/answers/${day}/${taskIndex}`, { \n      answer, \n      is_correct: isCorrect \n    }),\n};\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}