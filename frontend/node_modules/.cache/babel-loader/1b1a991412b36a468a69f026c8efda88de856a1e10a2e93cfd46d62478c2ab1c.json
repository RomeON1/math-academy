{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useTranslation}from'react-i18next';import{courseAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserProfile=_ref=>{let{user,onClose,onGradeChange}=_ref;const{t}=useTranslation();const[currentGrade,setCurrentGrade]=useState((user===null||user===void 0?void 0:user.grade)||6);const[gradeHistory,setGradeHistory]=useState([]);const[loading,setLoading]=useState(false);const[message,setMessage]=useState('');useEffect(()=>{if(user){setCurrentGrade(user.grade);fetchGradeHistory();}},[user]);const fetchGradeHistory=async()=>{try{const response=await courseAPI.getGradeHistory(user.id);setGradeHistory(response.data);}catch(error){console.error('Error fetching grade history:',error);}};const handleGradeChange=async()=>{if(currentGrade===user.grade)return;setLoading(true);setMessage('');try{await courseAPI.updateUserGrade(user.id,currentGrade);setMessage(t('profile.gradeUpdated','Класс успешно обновлен!'));if(onGradeChange){onGradeChange(currentGrade);}await fetchGradeHistory();// Обновляем историю\n}catch(error){setMessage(t('profile.updateError','Ошибка обновления класса'));console.error('Error updating grade:',error);}finally{setLoading(false);}};if(!user)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:t('profile.title','Личный кабинет')}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\",children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:t('profile.username','Имя пользователя')}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:user.username})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:t('profile.email','Email')}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:user.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:t('profile.currentGrade','Текущий класс')}),/*#__PURE__*/_jsx(\"select\",{className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",value:currentGrade,onChange:e=>setCurrentGrade(parseInt(e.target.value)),disabled:loading,children:Array.from({length:11},(_,i)=>i+1).map(grade=>/*#__PURE__*/_jsx(\"option\",{value:grade,children:grade},grade))}),/*#__PURE__*/_jsx(\"button\",{onClick:handleGradeChange,disabled:loading||currentGrade===user.grade,className:\"mt-3 w-full bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white py-2 rounded-md font-medium transition-colors\",children:loading?t('profile.updating','Обновление...'):t('profile.updateGrade','Обновить класс')})]}),message&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-md mb-4 \".concat(message.includes('Ошибка')?'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300':'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'),children:message}),gradeHistory.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-3\",children:t('profile.gradeHistory','История классов')}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:gradeHistory.map((record,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-900 dark:text-white\",children:[t('profile.grade','Класс'),\" \",record.grade]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500 dark:text-gray-400\",children:new Date(record.start_date).toLocaleDateString()})]},record.id))})]})]})]})});};export default UserProfile;","map":{"version":3,"names":["React","useState","useEffect","useTranslation","courseAPI","jsx","_jsx","jsxs","_jsxs","UserProfile","_ref","user","onClose","onGradeChange","t","currentGrade","setCurrentGrade","grade","gradeHistory","setGradeHistory","loading","setLoading","message","setMessage","fetchGradeHistory","response","getGradeHistory","id","data","error","console","handleGradeChange","updateUserGrade","className","children","onClick","username","email","value","onChange","e","parseInt","target","disabled","Array","from","length","_","i","map","concat","includes","record","index","Date","start_date","toLocaleDateString"],"sources":["/opt/math-app/frontend/src/components/UserProfile.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { courseAPI } from '../services/api';\n\nconst UserProfile = ({ user, onClose, onGradeChange }) => {\n  const { t } = useTranslation();\n  const [currentGrade, setCurrentGrade] = useState(user?.grade || 6);\n  const [gradeHistory, setGradeHistory] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n\n  useEffect(() => {\n    if (user) {\n      setCurrentGrade(user.grade);\n      fetchGradeHistory();\n    }\n  }, [user]);\n\n  const fetchGradeHistory = async () => {\n    try {\n      const response = await courseAPI.getGradeHistory(user.id);\n      setGradeHistory(response.data);\n    } catch (error) {\n      console.error('Error fetching grade history:', error);\n    }\n  };\n\n  const handleGradeChange = async () => {\n    if (currentGrade === user.grade) return;\n    \n    setLoading(true);\n    setMessage('');\n    \n    try {\n      await courseAPI.updateUserGrade(user.id, currentGrade);\n      setMessage(t('profile.gradeUpdated', 'Класс успешно обновлен!'));\n      if (onGradeChange) {\n        onGradeChange(currentGrade);\n      }\n      await fetchGradeHistory(); // Обновляем историю\n    } catch (error) {\n      setMessage(t('profile.updateError', 'Ошибка обновления класса'));\n      console.error('Error updating grade:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            {t('profile.title', 'Личный кабинет')}\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n          >\n            ✕\n          </button>\n        </div>\n\n        {/* Информация пользователя */}\n        <div className=\"mb-6\">\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              {t('profile.username', 'Имя пользователя')}\n            </label>\n            <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              {user.username}\n            </div>\n          </div>\n\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              {t('profile.email', 'Email')}\n            </label>\n            <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n              {user.email}\n            </div>\n          </div>\n\n          {/* Смена класса */}\n          <div className=\"mb-6\">\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n              {t('profile.currentGrade', 'Текущий класс')}\n            </label>\n            <select\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              value={currentGrade}\n              onChange={(e) => setCurrentGrade(parseInt(e.target.value))}\n              disabled={loading}\n            >\n              {Array.from({ length: 11 }, (_, i) => i + 1).map(grade => (\n                <option key={grade} value={grade}>\n                  {grade}\n                </option>\n              ))}\n            </select>\n            \n            <button\n              onClick={handleGradeChange}\n              disabled={loading || currentGrade === user.grade}\n              className=\"mt-3 w-full bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 text-white py-2 rounded-md font-medium transition-colors\"\n            >\n              {loading ? t('profile.updating', 'Обновление...') : t('profile.updateGrade', 'Обновить класс')}\n            </button>\n          </div>\n\n          {/* Сообщения */}\n          {message && (\n            <div className={`p-3 rounded-md mb-4 ${\n              message.includes('Ошибка') \n                ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300'\n                : 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300'\n            }`}>\n              {message}\n            </div>\n          )}\n\n          {/* История классов */}\n          {gradeHistory.length > 0 && (\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-3\">\n                {t('profile.gradeHistory', 'История классов')}\n              </h3>\n              <div className=\"space-y-2\">\n                {gradeHistory.map((record, index) => (\n                  <div key={record.id} className=\"flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded\">\n                    <span className=\"text-gray-900 dark:text-white\">\n                      {t('profile.grade', 'Класс')} {record.grade}\n                    </span>\n                    <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      {new Date(record.start_date).toLocaleDateString()}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default UserProfile;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}